{"ast":null,"code":"import _regeneratorRuntime from\"D:/React Projects/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/React Projects/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/React Projects/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{Component,useState,useEffect}from\"react\";import{useAuthState}from\"react-firebase-hooks/auth\";import{useHistory}from\"react-router\";import{auth,db,app,CurrentUser}from\"../firebase\";import*as utils from\"../Util\";import Transaction from'./Transaction';import{DataGrid}from\"@mui/x-data-grid\";import{jsx as _jsx}from\"react/jsx-runtime\";function History(){var _useAuthState=useAuthState(auth),_useAuthState2=_slicedToArray(_useAuthState,3),user=_useAuthState2[0],loading=_useAuthState2[1],error=_useAuthState2[2];var _useState=useState([]),_useState2=_slicedToArray(_useState,2),history_=_useState2[0],setHistory_=_useState2[1];var history=useHistory();var columns=[{field:'id',headerName:'ID',width:70},{field:'name',headerName:'Transaction Name',width:200},{field:'price',headerName:'Price',width:150},{field:'date',headerName:'Date',width:200},{field:'type',headerName:'Type',width:150}];useEffect(function(){var fetchUserName=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var query,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return db.collection(\"users\").where(\"uid\",\"==\",user===null||user===void 0?void 0:user.uid).get();case 3:query=_context.sent;_context.next=6;return query.docs[0].data();case 6:data=_context.sent;_context.next=13;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);console.error(_context.t0);alert(\"An error occured while fetching user data\");case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function fetchUserName(){return _ref.apply(this,arguments);};}();if(loading)return;if(!user)return history.replace(\"/\");app.database().ref('Transactions/'+(user===null||user===void 0?void 0:user.uid)).on(\"value\",function(data){console.log(data.val());if(data.val()!==null){var eachExpense=utils.eachExpense(data.val());var thisUsersExpenses=utils.currentUsersExpenses(eachExpense,user);setHistory_(thisUsersExpenses);}});fetchUserName();},[user,loading,history]);return/*#__PURE__*/ (//     <div className=\"latestTransactions\">\n//     <p>Latest Transactions</p>\n//     <ul>\n//         {\n//             Object.keys(history_).map((id) => (\n//                 <Transaction key={id}\n//                     type={history_[id].value.type}\n//                     name={history_[id].value.name}\n//                     price={history_[id].value.price}\n//                 />\n//             ))\n//         }\n//     </ul>\n// </div>\n_jsx(\"div\",{style:{height:400,width:'100%'},children:/*#__PURE__*/_jsx(DataGrid,{rows:[Object.keys(history_).map(function(id){return{id:id,name:history_[id].value.name,price:history_[id].value.type==='income'?+1*parseFloat(history_[id].value.price):-1*parseFloat(history_[id].value.price),date:history_[id].value.date,type:history_[id].value.type};})][0],columns:columns,pageSize:5,rowsPerPageOptions:[100],checkboxSelection:true})}));}export default History;","map":{"version":3,"sources":["D:/React Projects/my-app/src/pages/History.js"],"names":["React","Component","useState","useEffect","useAuthState","useHistory","auth","db","app","CurrentUser","utils","Transaction","DataGrid","History","user","loading","error","history_","setHistory_","history","columns","field","headerName","width","fetchUserName","collection","where","uid","get","query","docs","data","console","alert","replace","database","ref","on","log","val","eachExpense","thisUsersExpenses","currentUsersExpenses","height","Object","keys","map","id","name","value","price","type","parseFloat","date"],"mappings":"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","sourcesContent":["import React, { Component, useState, useEffect } from \"react\";\r\nimport { useAuthState } from \"react-firebase-hooks/auth\";\r\nimport { useHistory } from \"react-router\";\r\nimport { auth, db,app,CurrentUser } from \"../firebase\";\r\nimport * as utils from \"../Util\";\r\nimport Transaction from './Transaction';\r\nimport { DataGrid } from \"@mui/x-data-grid\";\r\n\r\n\r\nfunction History() {\r\n    const [user, loading, error] = useAuthState(auth);\r\n    const [history_, setHistory_] = useState([]);\r\n    const history = useHistory();\r\n    const columns = [\r\n        { field: 'id', headerName: 'ID', width: 70 },\r\n        { field: 'name', headerName: 'Transaction Name', width: 200 },\r\n        { field: 'price', headerName: 'Price', width: 150 },\r\n        {\r\n          field: 'date',\r\n          headerName: 'Date',\r\n          width: 200,\r\n        },\r\n        { field: 'type', headerName: 'Type', width: 150 },\r\n        \r\n      ];\r\n      \r\n    useEffect(() => {\r\n    \r\n        const fetchUserName = async () => {\r\n          try {\r\n            const query = await db\r\n              .collection(\"users\")\r\n              .where(\"uid\", \"==\", user?.uid)\r\n              .get();\r\n            const data = await query.docs[0].data();\r\n            \r\n            \r\n          } catch (err) {\r\n            console.error(err);\r\n            alert(\"An error occured while fetching user data\");\r\n          }\r\n        };\r\n        if (loading) return;\r\n        if (!user) return history.replace(\"/\");\r\n        \r\n\r\n        app.database().ref('Transactions/' + user?.uid).on(\"value\", data => {\r\n            console.log(data.val());\r\n            if(data.val() !== null)\r\n            {\r\n            const eachExpense = utils.eachExpense(data.val());\r\n            const thisUsersExpenses = utils.currentUsersExpenses(eachExpense, user);\r\n            \r\n            setHistory_(thisUsersExpenses);\r\n            \r\n           }\r\n          });\r\n\r\n        fetchUserName();\r\n      }, [user, loading,\r\n        history]);\r\n\r\n        \r\n  return (\r\n    //     <div className=\"latestTransactions\">\r\n    //     <p>Latest Transactions</p>\r\n    //     <ul>\r\n    //         {\r\n                \r\n    //             Object.keys(history_).map((id) => (\r\n    //                 <Transaction key={id}\r\n    //                     type={history_[id].value.type}\r\n    //                     name={history_[id].value.name}\r\n    //                     price={history_[id].value.price}\r\n    //                 />\r\n    //             ))\r\n    //         }\r\n    //     </ul>\r\n    // </div>\r\n    <div style={{ height: 400, width: '100%' }}>\r\n      <DataGrid\r\n        rows={\r\n            [Object.keys(history_).map((id) => (\r\n              {\r\n                  id: id,\r\n                  name: history_[id].value.name,\r\n                  price: history_[id].value.type === 'income' ?  +1 * parseFloat(history_[id].value.price) : -1 * parseFloat(history_[id].value.price),\r\n                  date: history_[id].value.date,\r\n                  type: history_[id].value.type,\r\n              }\r\n          ))][0]\r\n        }\r\n        columns={columns}\r\n        pageSize={5}\r\n        rowsPerPageOptions={[100]}\r\n        checkboxSelection\r\n      />\r\n      \r\n\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default History;"]},"metadata":{},"sourceType":"module"}